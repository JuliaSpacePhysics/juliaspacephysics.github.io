---
title: MMS Polarization Analysis
---

References: 
- [pyrfu documentation](https://pyrfu.readthedocs.io/en/latest/examples/01_mms/example_mms_polarizationanalysis.html)
- [Wave polarization using SCM data - PySPEDAS](https://github.com/spedas/mms-examples/blob/master/advanced/Wave_polarization_using_SCM_data.ipynb)

<!-- https://github.com/louis-richard/irfu-python/blob/master/pyrfu/pyrf/ebsp.py#L214 -->

> Perform polarization analysis on burst mode electric and magnetic fields.

```{julia}
#| code-summary: Setup
dir = "tutorials/mms_polarization"
if isdir(dir)
    cd(dir)
end

Pkg.activate(".")
Pkg.resolve()
Pkg.instantiate()

using PythonCall
using PySPEDAS
using CairoMakie, SpacePhysicsMakie
@py import pyspedas.analysis.tests.test_twavpol: TwavpolDataValidation
TwavpolDataValidation.setUpClass()
```


```{julia}
using DimensionalData
using PlasmaWaves

thc_scf_fac = PySPEDAS.get_data("thc_scf_fac") |> DimArray
res = twavpol(thc_scf_fac; fs=8)
res_svd = twavpol_svd(thc_scf_fac; fs=8)
f = Figure()
tplot(f[1, 1], res)
tplot(f[1, 2], res_svd)
f
```

## Overview plot

<!-- r_xyz = mms.get_data("r_gse_mec_srvy_l2", tint_long, ic, from_sdc=True)
b_xyz = mms.get_data("b_gse_fgm_brst_l2", tint, ic, from_sdc=True)
e_xyz = mms.get_data("e_gse_edp_brst_l2", tint, ic, from_sdc=True)
b_scm = mms.get_data("b_gse_scm_brst_l2", tint, ic, from_sdc=True) -->

```{julia}
using CDAWeb
using CDAWeb.CDFDatasets
t0 = "2015-10-30T05:15:42.000"
t1 = "2015-10-30T05:15:54.000"
tint = [t0, t1]

b_xyz = CDAWeb.get_data("MMS2_FGM_BRST_L2", "mms2_fgm_b_gse_brst_l2", t0, t1; orig=true)
e_xyz = CDAWeb.get_data("MMS2_EDP_BRST_L2_DCE", "mms2_edp_dce_gse_brst_l2", t0, t1; orig=true)
b_scm = CDAWeb.get_data("MMS2_SCM_BRST_L2_SCB", "mms2_scm_acb_gse_scb_brst_l2", t0, t1; orig=true)
```

```{julia}
using DimensionalData
b_xyz = DimArray(b_xyz)[1:3, :]
e_xyz = DimArray(e_xyz)
b_scm = DimArray(b_scm)
```


```{julia}
using CairoMakie
using CairoMakie.Makie
using SpaceDataModel: times

f = Figure()
# meta = getmeta(data)
ax = Axis(f[1, 1])
t = DateTime.(b_xyz.dims[2].val.data)
for v in eachrow(parent(b_xyz))
    lines!(t, v)
end

ax = Axis(f[2, 1]; xlabel="Time")
t = DateTime.(e_xyz.dims[2].val.data)
for v in eachrow(parent(e_xyz))
    lines!(t, v)
end
f
```

Compute electron cylotron frequency

## Polarization Analysis and Visualization

```{julia}
using PlasmaWaves

res = wavpol(e_xyz', 0.1)
```


```{julia}
ax = Axis(f[3, 1])
heatmap!(ax, res.indices, res.freqs, res.power)
f
```

## Reproducibility

::: {.callout-note collapse="true"}
## This tutorial was built using these direct dependencies

```{julia}
using Pkg
Pkg.status()
```
:::

::: {.callout-note collapse="true"}
## Machine and Julia version information

```{julia}
using InteractiveUtils # hide
versioninfo()
```
:::